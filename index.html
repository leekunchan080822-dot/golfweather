<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>711 專業版 V3｜雙模型精準高爾夫天氣預報</title>

<style>
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#f5f7fa;margin:0;padding:15px;}
.header-info{text-align:center;font-size:14px;color:#555;}
h2{text-align:center;margin:10px 0;}
.region-buttons{text-align:center;margin:15px 0;}
.region-buttons button{margin:4px;padding:6px 12px;border-radius:20px;border:1px solid #ccc;background:white;cursor:pointer;font-size:13px;}
.region-buttons button.active{background:#111;color:white;border-color:#111;}
.region-title{font-size:18px;font-weight:bold;margin:25px 0 10px;}
.card{background:white;border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 3px 10px rgba(0,0,0,0.08);}
.day-block{font-size:13px;margin-top:6px;padding-top:6px;border-top:1px solid #eee;}
.model-title{font-weight:bold;margin-top:6px;}
.error{color:red;}
small{color:#777;}
</style>
</head>
<body>

<div class="header-info" id="dateInfo"></div>
<div class="header-info">雙模型來源：Open-Meteo（全球數值模式）＋ 中央氣象署格點預報</div>
<h2>711 專業版 V3｜全台高爾夫球場 7 日雙模型預報</h2>

<div class="region-buttons" id="regionButtons"></div>
<div id="courses">載入中...</div>

<script>

/* ====== 請填入你的 CWA API KEY ====== */
const CWA_API_KEY = "CWA-60E4630E-A677-453A-BD76-C74F148C86ED";

/* ===== 日期 ===== */
const today=new Date();
document.getElementById("dateInfo").innerText="更新時間："+today.toLocaleString();

/* ===== 星期 ===== */
function getWeekday(dateStr){
    const d=new Date(dateStr);
    const arr=["週日","週一","週二","週三","週四","週五","週六"];
    return arr[d.getDay()];
}

/* ===== 全台球場完整清單（含經緯度） ===== */
const courses = [

/* 台北 / 新北 */
{ region:"台北市 / 新北市", name:"翡翠高爾夫球場", lat:25.0679, lon:121.4543 },
{ region:"台北市 / 新北市", name:"黃金海岸（北海）高爾夫球場", lat:25.2901, lon:121.5378 },
{ region:"台北市 / 新北市", name:"濱海高爾夫俱樂部", lat:25.2517, lon:121.5195 },
{ region:"台北市 / 新北市", name:"台灣（老淡水）高爾夫球場", lat:25.1964, lon:121.4415 },
{ region:"台北市 / 新北市", name:"大屯高爾夫球場", lat:25.2023, lon:121.5298 },
{ region:"台北市 / 新北市", name:"揮皇（新淡水）高爾夫球場", lat:25.2191, lon:121.4472 },
{ region:"台北市 / 新北市", name:"林口高爾夫球場", lat:25.0863, lon:121.3657 },
{ region:"台北市 / 新北市", name:"八里國際高爾夫球場", lat:25.1427, lon:121.3998 },
{ region:"台北市 / 新北市", name:"美麗華高爾夫球場", lat:25.1085, lon:121.5332 },
{ region:"台北市 / 新北市", name:"幸福高爾夫球場", lat:25.1815, lon:121.4376 },
{ region:"台北市 / 新北市", name:"東華高爾夫球場", lat:25.0962, lon:121.6033 },

/* 桃園 */
{ region:"桃園", name:"台北高爾夫球場", lat:25.0124, lon:121.3005 },
{ region:"桃園", name:"統帥高爾夫球場", lat:24.9967, lon:121.2831 },
{ region:"桃園", name:"長庚高爾夫球場", lat:25.0582, lon:121.3869 },
{ region:"桃園", name:"東方高爾夫球場", lat:24.9463, lon:121.2924 },
{ region:"桃園", name:"第一高爾夫球場", lat:24.9538, lon:121.2437 },
{ region:"桃園", name:"永漢高爾夫球場", lat:24.8942, lon:121.2715 },
{ region:"桃園", name:"桃園高爾夫球場", lat:25.0247, lon:121.2859 },
{ region:"桃園", name:"大溪高爾夫球場", lat:24.8837, lon:121.2806 },
{ region:"桃園", name:"龍潭高爾夫球場", lat:24.8634, lon:121.2187 },
{ region:"桃園", name:"揚昇高爾夫鄉村俱樂部", lat:24.8578, lon:121.1964 },

/* 花東 */
{ region:"花東", name:"礁溪高爾夫球場", lat:24.8124, lon:121.7501 },
{ region:"花東", name:"花蓮高爾夫球場", lat:23.9917, lon:121.6018 },

/* 新竹 / 苗栗 */
{ region:"新竹 / 苗栗", name:"再興高爾夫球場", lat:24.7893, lon:121.0234 },
{ region:"新竹 / 苗栗", name:"新竹（新豐）高爾夫球場", lat:24.8884, lon:120.9871 },
{ region:"新竹 / 苗栗", name:"東方之星高爾夫球場", lat:24.5418, lon:120.8724 },
{ region:"新竹 / 苗栗", name:"立益高爾夫球場", lat:24.5207, lon:120.8822 },
{ region:"新竹 / 苗栗", name:"旭陽高爾夫球場", lat:24.4693, lon:120.8438 },
{ region:"新竹 / 苗栗", name:"老爺關西高爾夫球場", lat:24.7986, lon:121.1777 },
{ region:"新竹 / 苗栗", name:"山溪地高爾夫球場", lat:24.4845, lon:120.9027 },
{ region:"新竹 / 苗栗", name:"寶山高爾夫球場", lat:24.7422, lon:120.9853 },
{ region:"新竹 / 苗栗", name:"皇家高爾夫球場", lat:24.6127, lon:120.8611 },
{ region:"新竹 / 苗栗", name:"全國高爾夫球場", lat:24.5754, lon:120.8149 },

/* 台中 / 彰化 / 南投 */
{ region:"台中 / 彰化 / 南投", name:"清泉崗高爾夫球場", lat:24.2102, lon:120.6041 },
{ region:"台中 / 彰化 / 南投", name:"豐原高爾夫球場", lat:24.2667, lon:120.7173 },
{ region:"台中 / 彰化 / 南投", name:"台中國際高爾夫球場", lat:24.1715, lon:120.7276 },
{ region:"台中 / 彰化 / 南投", name:"霧峰高爾夫球場", lat:24.0641, lon:120.7009 },

/* 嘉義 / 台南 / 高雄 / 屏東 */
{ region:"嘉義 / 台南 / 高雄 / 屏東", name:"棕梠湖（東洋）高爾夫球場", lat:23.4702, lon:120.4024 },
{ region:"嘉義 / 台南 / 高雄 / 屏東", name:"斑芝花高爾夫俱樂部", lat:23.0168, lon:120.4057 },
{ region:"嘉義 / 台南 / 高雄 / 屏東", name:"嘉光高爾夫球場", lat:23.4859, lon:120.4308 },
{ region:"嘉義 / 台南 / 高雄 / 屏東", name:"台南高爾夫球場（新化）", lat:23.0384, lon:120.3205 },
{ region:"嘉義 / 台南 / 高雄 / 屏東", name:"南一高爾夫球場", lat:23.1438, lon:120.4037 },
{ region:"嘉義 / 台南 / 高雄 / 屏東", name:"南寶高爾夫球場", lat:23.1025, lon:120.3268 },
{ region:"嘉義 / 台南 / 高雄 / 屏東", name:"大崗山高爾夫球場", lat:22.8533, lon:120.3542 },
{ region:"嘉義 / 台南 / 高雄 / 屏東", name:"信誼高爾夫球場", lat:22.7245, lon:120.3894 },
{ region:"嘉義 / 台南 / 高雄 / 屏東", name:"觀音山高爾夫球場", lat:22.7416, lon:120.3557 },
{ region:"嘉義 / 台南 / 高雄 / 屏東", name:"屏東高爾夫球場", lat:22.6694, lon:120.4882 }

];

/* ===== Open-Meteo ===== */
async function getOpenMeteo(lat,lon){
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min&forecast_days=7&timezone=Asia/Taipei`;
    try{
        const res=await fetch(url);
        const data=await res.json();
        let arr=[];
        for(let i=0;i<7;i++){
            arr.push({
                date:data.daily.time[i],
                minT:data.daily.temperature_2m_min[i],
                maxT:data.daily.temperature_2m_max[i]
            });
        }
        return arr;
    }catch(e){return null;}
}

/* ===== CWA ===== */
async function getCWA(lat,lon){
    const url=`https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-D0047-093?Authorization=${CWA_API_KEY}&format=JSON&Location=${lat},${lon}`;
    try{
        const res=await fetch(url);
        const data=await res.json();
        const loc=data.records.Locations[0].Location[0];
        const maxT=loc.WeatherElement.find(e=>e.ElementName==="MaxT").Time;
        const minT=loc.WeatherElement.find(e=>e.ElementName==="MinT").Time;
        let arr=[];
        for(let i=0;i<7;i++){
            arr.push({
                date:maxT[i].StartTime.substring(0,10),
                minT:minT[i].ElementValue[0].Value,
                maxT:maxT[i].ElementValue[0].Value
            });
        }
        return arr;
    }catch(e){return null;}
}

/* ===== UI ===== */
async function loadCourses(){
    let html="";
    for(const course of courses){
        html+=`<div class="card"><strong>${course.name}</strong><br><small>${course.lat},${course.lon}</small>`;
        const open=await getOpenMeteo(course.lat,course.lon);
        const cwa=await getCWA(course.lat,course.lon);

        if(!open&&!cwa){
            html+=`<div class="error">讀取失敗</div></div>`;
            continue;
        }

        for(let i=0;i<7;i++){
            html+=`<div class="day-block"><strong>${open?open[i].date:cwa[i].date}（${getWeekday(open?open[i].date:cwa[i].date)}）</strong><br>`;
            if(open) html+=`Open-Meteo：${open[i].minT}°C - ${open[i].maxT}°C<br>`;
            if(cwa) html+=`CWA：${cwa[i].minT}°C - ${cwa[i].maxT}°C<br>`;
            html+=`</div>`;
        }

        html+=`</div>`;
    }
    document.getElementById("courses").innerHTML=html;
}

loadCourses();

</script>
</body>
</html>
