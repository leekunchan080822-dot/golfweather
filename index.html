<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Golf Rain Radar</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background:#eef2f7;
    margin:0;
    padding:15px;
}

h2 { text-align:center; }

.region-btn {
    display:block;
    width:100%;
    padding:14px;
    margin:10px 0;
    border:none;
    border-radius:12px;
    font-size:16px;
    font-weight:bold;
    background:#1f6feb;
    color:white;
}

.card {
    background:white;
    border-radius:14px;
    padding:14px;
    margin-top:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

.hourly {
    display:flex;
    overflow-x:auto;
    margin-top:10px;
}

.hour {
    min-width:70px;
    text-align:center;
    margin-right:8px;
    font-size:13px;
}

.rain-low { color:green; }
.rain-mid { color:orange; }
.rain-high { color:red; font-weight:bold; }

.back-btn{
    margin-top:15px;
    background:#444;
}
</style>
</head>

<body>

<h2>ğŸŒï¸ Golf Rain Radar</h2>

<div id="main"></div>

<script>

const API_KEY = "fc4f1698bc8d47ba90757e3c03e713bc";

/* ä½ çµ¦çš„å€åŸŸåˆ†é¡ï¼ˆåªæ”¾åç¨±ï¼‰ */
const regions = {
"å°åŒ—å¸‚ã€æ–°åŒ—å¸‚":[
"ç¿¡ç¿ ","é»ƒé‡‘æµ·å²¸(åŒ—æµ·)","æ¿±æµ·","å¤§å±¯","å°ç£(è€æ·¡æ°´)",
"æ®çš‡(æ–°æ·¡æ°´)","åœ‹è¯","å…«é‡Œåœ‹éš›","ç¾éº—è¯","å¹¸ç¦","æ±è¯","æ—å£"
],

"æ¡ƒåœ’åœ°å€":[
"å°åŒ—","çµ±å¸¥","ç¬¬ä¸€","æ°¸æ¼¢","é•·åºš","æ±æ–¹",
"å¤§æºª","æ¡ƒåœ’","é¾æ½­","æšæ˜‡","æ¥Šæ¢…"
],

"èŠ±æ±åœ°å€":[
"ç¤æºª","èŠ±è“®"
],

"æ–°ç«¹ã€è‹—æ —":[
"å†èˆˆ","æ–°ç«¹(æ–°è±)","ç«‹ç›Š","æ—­é™½","è€çˆºé—œè¥¿",
"å±±æºªåœ°","å¯¶å±±","çš‡å®¶","å…¨åœ‹"
],

"å°ä¸­ã€å½°åŒ–ã€å—æŠ•":[
"æ¸…æ³‰å´—","è±åŸ","å°ä¸­åœ‹éš›","é´»ç¦§å¤ªå¹³",
"éœ§å³°","å°è±","å½°åŒ–","å—å³°","æ¾æŸå¶º"
],

"å˜‰ç¾©ã€å°å—ã€é«˜é›„ã€å±æ±":[
"æ£•æ¢ æ¹–","å˜‰å…‰","æ–‘èŠèŠ±","å˜‰å—","å—å¯¶",
"å°å—(æ–°åŒ–)","å—ä¸€","å¤§å´—å±±","è§€éŸ³å±±","ä¿¡èª¼","å±±æ¹–è§€"
]
};


/* ç”¨çƒå ´åç¨±æŸ¥è©¢å¤©æ°£ */
async function getWeatherByName(name){
    const geoUrl = `https://api.openweathermap.org/geo/1.0/direct?q=${name},Taiwan&limit=1&appid=${API_KEY}`;
    const geoRes = await fetch(geoUrl);
    const geoData = await geoRes.json();

    if(!geoData[0]) return null;

    const {lat, lon} = geoData[0];

    const weatherUrl =
    `https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&exclude=minutely,daily,alerts&units=metric&appid=${API_KEY}`;

    const res = await fetch(weatherUrl);
    return await res.json();
}

function rainClass(pop){
    if(pop < 0.3) return "rain-low";
    if(pop < 0.6) return "rain-mid";
    return "rain-high";
}

/* é¡¯ç¤ºå€åŸŸæŒ‰éˆ• */
function showRegions(){
    let html = "";
    for(const region in regions){
        html += `<button class="region-btn" onclick="loadRegion('${region}')">${region}</button>`;
    }
    document.getElementById("main").innerHTML = html;
}

/* è¼‰å…¥å€åŸŸçƒå ´ */
async function loadRegion(region){

    document.getElementById("main").innerHTML = "è¼‰å…¥ä¸­...";

    let html = `<button class="region-btn back-btn" onclick="showRegions()">â† è¿”å›å€åŸŸ</button>`;

    for(const course of regions[region]){

        const data = await getWeatherByName(course);

        if(!data) continue;

        const current = data.current;
        const hourly = data.hourly.slice(0,12);

        html += `
        <div class="card">
            <strong>${course}</strong><br>
            ğŸŒ¡ ${current.temp}Â°Cã€€
            ğŸŒ¬ ${(current.wind_speed*3.6).toFixed(1)} km/h

            <div class="hourly">
        `;

        hourly.forEach(h=>{
            const hour = new Date(h.dt*1000).getHours();
            const pop = Math.round(h.pop*100);
            html += `
                <div class="hour ${rainClass(h.pop)}">
                    ${hour}:00<br>
                    â˜” ${pop}%
                </div>
            `;
        });

        html += `</div></div>`;
    }

    document.getElementById("main").innerHTML = html;
}

showRegions();

</script>

</body>
</html>
